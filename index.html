<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Fuzzy Lyrics Pro</title>

<style>
:root {
  --neon:#00ff88; --blue:#00d4ff; --pink:#ff00ff; --yellow:#ffcc00;
  --bg:#0a0a0a; --card:#1a1a1a;
}

body {
  font-family:-apple-system,sans-serif;
  background:var(--bg); color:#e0e0e0;
  margin:0; overflow:hidden; touch-action:none;
}

/* Splash */
#splash-screen{
  position:fixed; inset:0;
  background:linear-gradient(rgba(0,0,0,.5),rgba(0,0,0,.9));
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:3000; transition:.8s;
}
#splash-screen.hidden{opacity:0;visibility:hidden}
.floating-title{
  font-size:4.5rem;font-weight:900;text-transform:uppercase; text-align: center;
  animation:neonDrift 5s infinite ease-in-out;
}
@keyframes neonDrift{
  0%,100%{color:var(--neon);text-shadow:0 0 20px var(--neon)}
  33%{color:var(--blue);text-shadow:0 0 20px var(--blue)}
  66%{color:var(--pink);text-shadow:0 0 20px var(--pink)}
}
.start-btn{
  background:var(--neon);color:black;border:none;
  padding:20px 50px;border-radius:50px;
  font-weight:bold;font-size:1.5rem;cursor:pointer;
}

/* Library */
.container{max-width:500px;margin:auto;padding:20px;display:none;height:100vh;overflow-y:auto}
.card{background:var(--card);padding:20px;border-radius:15px;margin-bottom:20px}
input,textarea{
  width:100%;padding:12px;background:#252525;color:white;
  border:1px solid #444;border-radius:8px;margin-bottom:10px;box-sizing: border-box;
}
.song-item{
  background:var(--card);padding:15px;border-radius:12px;
  margin-top:12px;border-left:4px solid var(--neon);
  display: flex; justify-content: space-between; align-items: center;
}

/* Performance */
#scroller-overlay{
  display:none;position:fixed;inset:0;background:black;z-index:1000;
}
#scroll-content{
  white-space:pre-wrap;font-family:Courier New,monospace;
  font-size:28px;line-height:2.3;
  padding:50vh 20px 80vh;
  position:absolute;width:100%;color:white;
  transition: transform 0.1s linear;
}
.focus-zone{
  position:fixed;top:50%;left:0;width:100%;height:85px;
  transform:translateY(-50%);
  background:rgba(0,255,136,.1);
  border-top:2px solid var(--neon);
  border-bottom:2px solid var(--neon);
  pointer-events:none;
}

.top-nav{
  position:fixed;top:10px;width:100%;display:flex;gap:6px;
  padding:0 5px;z-index:1005; box-sizing: border-box;
}
.nav-group{flex:1;text-align:center}
.nav-btn{
  width:100%;padding:12px;border:none;border-radius:10px;
  font-weight:bold;font-size:10px;cursor:pointer;
}
.mic-btn{background:#444;color:white}
.mic-on{background:var(--neon)!important;color:black!important}
.btn-yellow{background:var(--yellow)}
.btn-blue{background:var(--blue)}
.speed-readout{font-size:11px;font-weight:900;color:var(--blue)}

#big-countdown{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:10rem;font-weight:900;
  color:rgba(0,255,136,.35);
  pointer-events:none;display:none;z-index:1001;
}

#pause-status-bar{
  position:fixed;bottom:20px;left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.9);
  border:2px solid var(--neon);
  padding:15px 30px;border-radius:50px;
  display:none;font-weight:bold; white-space: nowrap;
}
</style>
</head>

<body>

<div id="splash-screen">
  <div class="floating-title">Fuzzy<br>Lyrics</div>
  <button class="start-btn" onclick="enterApp()">START PERFORMANCE</button>
</div>

<div class="container" id="library-view">
  <h1 style="color:var(--neon);text-align:center;">Setlist Library</h1>
  <div class="card">
    <input id="songTitle" placeholder="Song Title">
    <input id="songLength" type="number" placeholder="Secs (guide)">
    <textarea id="songText" rows="8" placeholder="Lyrics & Chords..."></textarea>
    <button class="start-btn" style="width:100%;font-size:1rem" onclick="saveSong()">SAVE</button>
    <div style="opacity:.6;margin-top:10px;text-align:center;">Setlist Mode – Coming Soon</div>
  </div>
  <div id="songList"></div>
</div>

<div id="scroller-overlay">
  <div id="big-countdown">10</div>
  <div class="focus-zone"></div>
  <div class="top-nav">
    <div class="nav-group"><button id="micBtn" class="nav-btn mic-btn">MIC</button></div>
    <div class="nav-group"><button class="nav-btn btn-yellow" onclick="adjustSpeed(1.1)">SLOWER</button></div>
    <div class="nav-group"><button class="nav-btn" style="background:#fff; color:#000" onclick="triggerPause()">PAUSE</button></div>
    <div class="nav-group">
      <button class="nav-btn btn-blue" onclick="adjustSpeed(0.9)">FASTER</button>
      <div id="speedIndicator" class="speed-readout">0%</div>
    </div>
    <div class="nav-group"><button class="nav-btn" style="background: #ff4444" onclick="exitSong()">EXIT</button></div>
  </div>
  <div id="scroll-content"></div>
  <div id="pause-status-bar">PAUSED – RESUMING IN <span id="pause-num">10</span>s</div>
</div>

<script>
// Use document.getElementById for hyphenated IDs
const splash = document.getElementById("splash-screen");
const library = document.getElementById("library-view");
const overlay = document.getElementById("scroller-overlay");
const content = document.getElementById("scroll-content");
const countdownDisplay = document.getElementById("big-countdown");
const pauseBar = document.getElementById("pause-status-bar");
const pauseNum = document.getElementById("pause-num");

let songs = JSON.parse(localStorage.getItem("fuzzy_index"))||[];
let currentIndex=0, currentSong=null;
let currentY=0, isPaused=true, isCounting=false;
let speedBase=0, speedMod=0, recognition=null, micOn=false;
let scrollAnim; // To track animation frame

function enterApp(){
  splash.classList.add("hidden");
  setTimeout(()=>{ library.style.display="block" }, 800);
  renderList();
}

function renderList(){
  document.getElementById("songList").innerHTML = songs.map((s,i)=>`
    <div class="song-item">
      <b>${s.title}</b>
      <button class="nav-btn" style="width:60px; background:var(--neon); color:black" onclick="playSong(${i})">PLAY</button>
    </div>`).join("");
}

function saveSong(){
  const title = document.getElementById("songTitle");
  const text = document.getElementById("songText");
  const len = document.getElementById("songLength");
  
  if(!title.value || !text.value) return;
  songs.push({title: title.value, length: +len.value || 180, text: text.value});
  localStorage.setItem("fuzzy_index", JSON.stringify(songs));
  title.value = text.value = len.value = "";
  renderList();
}

function playSong(i){
  currentIndex = i; 
  currentSong = songs[i];
  content.innerText = currentSong.text + "\n\n--- FINISH ---";
  overlay.style.display = "block";
  
  currentY = 0; 
  speedMod = 0;
  document.getElementById("speedIndicator").innerText = "0%";
  
  // Wait for DOM update to calculate height correctly
  setTimeout(() => {
    speedBase = (content.scrollHeight) / (currentSong.length * 60); 
    startCountdown();
  }, 100);
}

function startCountdown(){
  let c = 5; // Reduced for testing
  isPaused = true; 
  isCounting = true;
  countdownDisplay.style.display = "block"; 
  countdownDisplay.innerText = c;
  
  let t = setInterval(() => {
    c--; 
    countdownDisplay.innerText = c;
    if(c <= 0){
      clearInterval(t);
      countdownDisplay.style.display = "none";
      isPaused = false;
      isCounting = false;
      cancelAnimationFrame(scrollAnim); // Clear any old loops
      scroll();
    }
  }, 1000);
}

function scroll(){
  if(isPaused) return;
  currentY += speedBase * (1 + speedMod);
  content.style.transform = `translateY(-${currentY}px)`;
  
  if(currentY < content.scrollHeight) {
      scrollAnim = requestAnimationFrame(scroll);
  }
}

function triggerPause(){
  if(isCounting || isPaused) return;
  isPaused = true; 
  pauseBar.style.display = "block";
  let c = 10; 
  pauseNum.innerText = c;
  
  let t = setInterval(() => {
    c--; 
    pauseNum.innerText = c;
    if(c <= 0){
      clearInterval(t);
      pauseBar.style.display = "none";
      startCountdown();
    }
  }, 1000);
}

function adjustSpeed(f){
  // If f is 0.9, we want it to go faster, so speedMod increases
  if(f < 1) speedMod += 0.1;
  else speedMod -= 0.1;
  document.getElementById("speedIndicator").innerText = Math.round(speedMod * 100) + "%";
}

function exitSong(){
  cancelAnimationFrame(scrollAnim);
  isPaused = true;
  overlay.style.display = "none";
}

/* MIC TOGGLE */
document.getElementById("micBtn").onclick = () => {
  if(!recognition){
    const SR = window.webkitSpeechRecognition || window.SpeechRecognition;
    if(!SR) { alert("Speech not supported"); return; }
    recognition = new SR(); 
    recognition.continuous = true;
    recognition.onresult = e => {
      let r = e.results[e.results.length-1][0].transcript.toLowerCase();
      if(r.includes("pause")) triggerPause();
      if(r.includes("resume")) {
          if(isPaused && !isCounting) {
              pauseBar.style.display = "none"; // Hide pause bar if active
              startCountdown();
          }
      }
    };
  }
  
  micOn = !micOn;
  document.getElementById("micBtn").classList.toggle("mic-on", micOn);
  micOn ? recognition.start() : recognition.stop();
};
</script>
</body>
</html>
